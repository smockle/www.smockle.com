<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta content name=author><meta name=supported-color-schemes content="light dark"><meta name=theme-color content="#26856d"><link rel=icon href=https://www.smockle.comassets/images/favicon.png><link rel=apple-touch-icon href=https://www.smockle.comassets/images/apple-touch-icon.png><title>Smockle Blog - Optimizing Web Fonts</title><meta property="og:title" content="Smockle Blog - Optimizing Web Fonts"><meta name=twitter:title content="Smockle Blog - Optimizing Web Fonts"><meta property="og:site_url" content="https://blog.smockle.com/2019/05/24/optimizing-web-fonts/"><meta property="og:image" content="https://www.smockle.comassets/images/og-image.png"><meta property="twitter:image" content="https://www.smockle.comassets/images/twitter-image.png"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><link href=/assets/css/style.css rel=stylesheet></head><body><div class=navigation><section id=wrapper><header class=h-card><a class=u-url href=/blog/><img id=avatar class="u-photo logo" src=https://www.smockle.comassets/images/smockle.svg width=48 height=48></a></header></section></div><article class="h-entry post"><header><div class=dates><time class=dt-published datetime="2019-05-24 00:00:00 +0000">May 24, 2019</time></div><h1 class=p-name>Optimizing Web Fonts</h1></header><section class="e-content post-body"><p>I audited this site with <a href=https://developers.google.com/web/tools/lighthouse/#devtools>Google Lighthouse</a>. The utility flagged web font load times (specifically the “Flash of Invisible Text” or “FOIT”). There are many ways to improve web font performance. Zach Leatherman’s <a href=https://www.zachleat.com/web/comprehensive-webfonts/>“A Comprehensive Guide to Font Loading Strategies”</a> is an excellent resource. I’ll describe the options I considered below.</p><p>I could display a fallback font while my web font downloads using <a href=https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display><code>font-display</code></a>. Unfortunately, <code>serif</code> (my fallback font) does not have the same x-height and width as <a href=https://github.com/skosch/CrimsonProS><code>'Crimson Pro S'</code></a> (my web font). Monica Dinculescu created a <a href=https://meowni.ca/font-style-matcher/>“Font Style Matcher”</a> tool that overlaps two fonts so appropriate CSS adjustments (e.g. <code>letter-spacing</code>) can be identified. But CSS adjustments would affect both my fallback font <em>and my web font</em>.</p><p>I could use the JavaScript <a href=https://developer.mozilla.org/en-US/docs/Web/API/FontFace/FontFace>Font Loading API</a> to load a web font and then append a <code>.font-loaded</code> class to the <code>html</code> or <code>body</code> element<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. This approach would facilitate separate CSS rules for fallback and web fonts. But browser support is limited, and I feared using the Font Loading API alongside <code>@font-face</code> declarations would cause duplicate downloads.</p><p>So I took a different approach. Web fonts with smaller file sizes download and display more quickly. Rather than adjusting my fallback font, I used the Python library <code>pyftsubset</code> to remove OpenType features and unused characters from my web font<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. Andrew Brampton describes this in <a href=https://blog.bramp.net/post/2018/01/21/google-font-features/>“Google Font Features”</a>.</p><p>First, I installed <code>pyftsubset</code> and related packages:</p><pre><code>$ pip install fonttools
$ pip install zopfli
$ pip install brotli
</code></pre><p>Next, I installed Filament Group’s <a href=https://github.com/filamentgroup/glyphhanger><code>glyphhanger</code></a> utility and crawled my website to obtain a list of the Unicode characters I use:</p><pre><code>$ npm install -g glyphhanger
$ glyphhanger [www.smockle.com](https://www.smockle.com) --spider-limit=10
</code></pre><p>Finally, I optimized my fonts with <code>pyftsubset</code>:</p><pre><code>$ pyftsubset crimsonpros-regular.otf --layout-features='liga,locl,sups,ordn,tnum,frac,kern' --unicodes=&quot;U+0000-00FF, U+0152, U+0153, U+0178, U+02C6, U+02DC, U+2000-206F, U+20AC, U+2122, U+25FC, U+FB01, U+FB02&quot; --flavor=woff2 --output-file=crimsonpros-regular.woff2
</code></pre><p>The result was a 40% smaller font. I verified the included characters and OpenType features using <a href=https://fontdrop.info>Font Drop</a> and I did a quick visual check before deploying.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Update: I’m now using <a href=https://www.gatsbyjs.org/packages/gatsby-plugin-web-font-loader/><code>gatsby-plugin-web-font-loader</code></a> to add a CSS class to <code>html</code> when my web fonts load. See <a href=https://github.com/smockle/smockle.com/commit/7efeff6f76e65c57711f31d63ac191b35c64cedf>this commit</a>. Fonts are not downloaded twice. This was easy after all! <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p><a href=https://www.fontsquirrel.com/tools/webfont-generator>Font Squirrel’s Webfont Generator</a> is popular and arguably easier to use. Unfortunately, no matter which options I selected, <code>liga</code> and all ligatures were always stripped out. According to <a href=https://twitter.com/FontSquirrel/status/14854008143>a 2010 tweet</a>, the Font Squirrel OpenType “Keep All Features” option “works for most fonts, but not all.” Crimson Pro S is one of the unlucky few. <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></section></article><footer><div class=post-meta>© 2020 Clay Miller ~ Licensed under
<a rel=license href=http://creativecommons.org/licenses/by/4.0/legalcode>CC-BY-4.0</a> ~ <a href=/feed.xml>RSS</a></div></footer></body></html>